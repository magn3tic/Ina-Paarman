{% comment %}
  Renders a Shopify Forms app form
  Accepts:
  - id: {String} The ID of the form to display (required)

  Usage:
  {% render 'shopify-form', id: '123456789' %}
{% endcomment %}

<div class="shopify-form-container">
  {%- if id != blank -%}
    <div 
      class="shopify-custom-form" 
      data-form-type="contact" 
      data-form-id="{{ id }}"
      id="shopify-form-{{ id }}">
      <div class="shopify-form-loading">Loading form...</div>
    </div>
    
    {% unless request.design_mode %}
    <script>
      function loadShopifyFormsScript() {
        // Check if the Shopify form embedding script exists
        if (!document.getElementById('shopify-forms-app-script')) {
          console.log('[Shopify Forms Snippet] Attempting to load embedder script.');
          var script = document.createElement('script');
          script.id = 'shopify-forms-app-script';
          script.src = 'https://cdn.shopify.com/shopifycloud/shopify_forms/assets/embedder/loader.js';
          script.defer = true;
          script.onload = function() {
            console.log('[Shopify Forms Snippet] Embedder script loaded successfully via onload.');
            // The loader.js script should automatically find and replace the placeholder divs.
          };
          script.onerror = function() {
            console.error('[Shopify Forms Snippet] Failed to load embedder script.');
            var placeholder = document.getElementById('shopify-form-{{ id }}');
            if (placeholder) {
              placeholder.innerHTML = '<div class="shopify-form-error">Error loading form script.</div>';
            }
          };
          document.head.appendChild(script);
        } else {
          console.log('[Shopify Forms Snippet] Embedder script already present.');
           // If script exists but form didn't load, the loader.js might need a nudge or failed silently.
           // We could try manually triggering its scan, but let's see if the loader works first.
           // Example (if Shopify Forms exposes an init function, which is not guaranteed):
           // if (window.ShopifyForms && typeof window.ShopifyForms.scan === 'function') { window.ShopifyForms.scan(); }
        }
      }

      // Wait for the DOM to be ready before trying to load the script
      if (document.readyState === 'loading') { 
        document.addEventListener('DOMContentLoaded', loadShopifyFormsScript);
      } else { // `DOMContentLoaded` has already fired or state is interactive/complete
        loadShopifyFormsScript();
      }
    </script>
    {% endunless %}
  {%- else -%}
    <div class="shopify-form-error">Form ID is required</div>
  {%- endif -%}
</div> 