class PredictiveSearch extends HTMLElement{constructor(){super(),this.form=this.querySelector("form.search-form"),this.input=this.form.querySelector('input[type="search"]'),this.results=this.form.querySelector("#predictive-search"),this.status=this.form.querySelector("#predictive-search-status"),this.emptyContainer=this.querySelector(".search-empty"),this.cartUpsells=this.querySelector(".cart-upsells"),this.input.addEventListener("input",window.theme.debounce((e=>{this.getSearchResults()}),300).bind(this)),document.querySelector("#offcanvas-search")?.addEventListener("shown.bs.offcanvas",(()=>{this.input.focus()})),this.accessibilityEventIsInit=!1}async getSearchResults(){const e=this.input.value.trim();if(e.length){const t=await fetch(`${window.Shopify.routes.predictive_search_url}?q=${e}&resources[type]=${this.dataset.resourcesType}&resources[limit]=10&section_id=predictive-search`);if(t.ok){const e=await t.text(),s=(new DOMParser).parseFromString(e,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;this.results.innerHTML=s,this.emptyContainer.setAttribute("hidden","hidden"),this.cartUpsells.setAttribute("hidden","hidden"),this.input.setAttribute("aria-expanded","true"),this.status.textContent=this.querySelector("#predictive-search-results").dataset.resultsText,this.results.querySelectorAll(".jdgm-prev-badge__stars").forEach((e=>{e.setAttribute("tabindex","-1")})),this.handleAccessibility()}}else this.emptyContainer.removeAttribute("hidden"),this.cartUpsells.removeAttribute("hidden"),this.results.innerHTML="",this.input.setAttribute("aria-expanded","false"),this.input.removeAttribute("aria-activedescendant"),this.status.textContent=""}handleAccessibility(){let e=-1;this.accessibilityEventIsInit||(this.addEventListener("keyup",(function(t){const s=this.querySelectorAll("#predictive-search-results a, #predictive-search-results button");if(s.length)switch("ArrowUp"!==t.code&&"ArrowDown"!==t.code||s.forEach((e=>{e.closest('[role="option"]').setAttribute("aria-selected","false")})),t.code){case"ArrowUp":e<=0&&(e=s.length),e--,s.forEach(((t,s)=>{s===e&&(t.focus(),t.closest('[role="option"]').setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",t.closest('[role="option"]').getAttribute("id")))}));break;case"ArrowDown":e===s.length-1&&(e=-1),e++,s.forEach(((t,s)=>{s===e&&(t.focus(),t.closest('[role="option"]').setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",t.closest('[role="option"]').getAttribute("id")))}));break;case"Enter":console.log("Enter")}})),this.accessibilityEventIsInit=!0)}}customElements.define("predictive-search",PredictiveSearch);
