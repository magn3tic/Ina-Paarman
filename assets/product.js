class ProductForm extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.productOptions=this.form.querySelectorAll('.product-options [name*="option"]'),this.atcBtn=this.form.querySelector(".btn-atc"),this.buyBtn=this.form.querySelector(".btn-buy"),this.form.addEventListener("submit",(t=>this.onSubmit(t))),this.productOptions.forEach((t=>t.addEventListener("change",(t=>this.onChangeProductOption(t))))),this.buyBtn?.addEventListener("click",(t=>this.onClickBuyBtn(t)))}async onChangeProductOption(t){t.preventDefault();const e=[];this.productOptions.forEach((t=>{("radio"===t.type&&t.checked||"select-one"===t.type)&&e.push(t.value)}));const i=JSON.parse(this.form.dataset.variants).find((t=>JSON.stringify(t.options)===JSON.stringify(e)));if(console.log(i),this.adjustPricing(i),this.adjustButtons(i),i){if(this.querySelector('[name="id"]').value=i.id,this.closest(".product-main")){const t=new URL(window.location);t.searchParams.set("variant",i.id),window.history.replaceState({},"",t)}window.dispatchEvent(new CustomEvent("kt.product.variant.change",{detail:i}))}}adjustPricing(t){if(!t)return;const e=this.form.querySelector(".product-price-compare"),i=this.form.querySelector(".product-price-final"),s=this.form.querySelector(".product-sale-badge"),n=this.form.querySelector(".product-sold-out-badge");if(t.compare_at_price>t.price)if(e.textContent=window.Shopify.formatMoney(t.compare_at_price),e.removeAttribute("hidden"),i.innerHTML=`<span class="visually-hidden">${window.theme.locales.product.sale_price}}</span>${window.Shopify.formatMoney(t.price)}`,i.classList.add("product-price-final-sale"),s.removeAttribute("hidden"),"percentage"===s.dataset.discountType){const e=100-Math.round(t.price/t.compare_at_price*100)+"%";s.textContent=`${window.theme.locales.product.save} ${e}`}else{const e=window.Shopify.formatMoney(t.compare_at_price-t.price);s.textContent=`${window.theme.locales.product.save} ${e}`}else e.textContent="",e.setAttribute("hidden","hidden"),i.innerHTML=window.Shopify.formatMoney(t.price),i.classList.remove("product-price-final-sale"),s.textContent="",s.setAttribute("hidden","hidden");t.available?n.setAttribute("hidden","hidden"):n.removeAttribute("hidden")}adjustButtons(t){t?t.available?(this.atcBtn.removeAttribute("disabled"),this.buyBtn?.removeAttribute("disabled"),this.atcBtn.innerHTML=window.theme.locales.product.add_to_cart):(this.atcBtn.setAttribute("disabled","disabled"),this.buyBtn?.setAttribute("disabled","disabled"),this.atcBtn.innerHTML=window.theme.locales.product.sold_out):(this.atcBtn.setAttribute("disabled","disabled"),this.buyBtn?.setAttribute("disabled","disabled"),this.atcBtn.innerHTML=window.theme.locales.product.unavailable)}async onSubmit(t){t.preventDefault(),this.atcBtn.classList.add("loading"),this.atcBtn.disabled=!0,this.atcBtn.setAttribute("aria-busy","true");const e=new FormData(this.form);await document.querySelector("cart-container").add(e),this.atcBtn.classList.remove("loading"),this.atcBtn.disabled=!1,this.atcBtn.setAttribute("aria-busy","false")}onClickBuyBtn(){this.buyBtn.classList.add("loading");const t=this.form.querySelector('[name="id"]').value,e=Number(this.form.querySelector('input[name="quantity"]')?.value||1);window.location.href=`/cart/${t}:${e}`}}customElements.define("product-form",ProductForm);class ProductMediaGallery extends HTMLElement{constructor(){super();const t=Number(this.dataset.initialSlide);this.thumbs=new window.Swiper(this.querySelector(".swiper-thumbs"),this.thumbsOptions()),this.main=new window.Swiper(this.querySelector(".swiper-main"),this.mainOptions()),this.main.slideTo(t),this.setStickyPosition(),this.listenVariantChange()}thumbsOptions(){return{slidesPerView:Number(this.dataset.thumbsPerView),spaceBetween:10}}mainOptions(){return{speed:Number(this.dataset.speed),rewind:!0,pagination:{type:"bullets",el:".swiper-pagination",dynamicBullets:!0,dynamicMainBullets:2,renderFraction:function(t,e){return`<span class="${t}"></span>/<span class="${e}"></span>`}},navigation:{nextEl:this.querySelector(".swiper-button-next"),prevEl:this.querySelector(".swiper-button-prev")},thumbs:{swiper:this.thumbs,autoScrollOffset:1}}}setStickyPosition(){if(this.closest(".product-main")&&window.matchMedia("(min-width: 1200px)").matches){const t=document.querySelector("#header-group.sticky-top");let e=window.scrollY;window.addEventListener("scroll",(()=>{const i=window.scrollY;i>e?i>t.clientHeight&&(this.style.top="20px"):i<e&&(this.style.top=`${t.clientHeight+20}px`),e=Math.max(window.scrollY,0)}))}}listenVariantChange(){window.addEventListener("kt.product.variant.change",(t=>{const e=t.detail;e.featured_media&&this.main.slideTo(e.featured_media.position-1)}),!1)}}customElements.define("product-media-gallery",ProductMediaGallery);const adjustShopifySubscriptionsStyling=()=>{document.querySelectorAll('.shopify_subscriptions_app_block [type="radio"]').forEach((t=>{t.classList.add("form-check-input")}))};adjustShopifySubscriptionsStyling(),window.addEventListener("kt.product.quick_view.modal_shown",adjustShopifySubscriptionsStyling);
